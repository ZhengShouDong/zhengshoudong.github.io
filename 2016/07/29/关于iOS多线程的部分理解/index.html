<!DOCTYPE html>
<html lang="zh">
    <head>
    <!-- Title -->
    
    <title>
        
            关于iOS多线程的部分理解 | 
        
        ZHENGSHOUDONG
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="ZHENGSHOUDONG">
    <meta name="description" content="null">
    <meta name="keywords" content="郑守栋 iOS javascript c# html ZHosts 翻墙,iOS多线程开发">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="ZHENGSHOUDONG">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://zhengshoudong.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="关于iOS多线程的部分理解 | ZHENGSHOUDONG">
    <meta property="og:description" content="null">
    <meta property="og:article:tag" content="iOS多线程开发"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
        <!-- <script src="/js/jquery.min.js"></script> -->
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('你正在使用UC浏览器内核的浏览器浏览.\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器');
        }
    </script>

    

    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#关于iOS开发的多线程的理解"><span class="post-toc-number">1.</span> <span class="post-toc-text">关于iOS开发的多线程的理解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pthreads"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Pthreads</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#NSThread"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">NSThread</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#GCD"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">GCD</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#任务和队列"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">任务和队列</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#同步执行-sync-会阻塞当前线程并等待-Block-中的任务执行完毕，然后当前线程才会继续往下运行"><span class="post-toc-number">1.4.0.1.</span> <span class="post-toc-text">同步执行(sync):会阻塞当前线程并等待 Block 中的任务执行完毕，然后当前线程才会继续往下运行.</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#异步执行-async-当前线程会直接往下执行，它不会阻塞当前线程"><span class="post-toc-number">1.4.0.2.</span> <span class="post-toc-text">异步执行(async):当前线程会直接往下执行，它不会阻塞当前线程.</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建队列"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">创建队列</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建任务"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">创建任务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#代码一"><span class="post-toc-number">1.6.0.0.1.</span> <span class="post-toc-text">代码一</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#执行结果"><span class="post-toc-number">1.6.0.0.2.</span> <span class="post-toc-text">执行结果</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#为什么"><span class="post-toc-number">1.6.0.0.3.</span> <span class="post-toc-text">为什么?</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#代码二"><span class="post-toc-number">1.6.0.0.4.</span> <span class="post-toc-text">代码二</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                关于iOS多线程的部分理解
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>ZHENGSHOUDONG</strong>
        <span>7月 29, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/iOS多线程开发/">iOS多线程开发</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=关于iOS多线程的部分理解&url=https://zhengshoudong.github.io//2016/07/29/关于iOS多线程的部分理解/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=关于iOS多线程的部分理解&url=https://zhengshoudong.github.io//2016/07/29/关于iOS多线程的部分理解/index.html&via=ZHENGSHOUDONG" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://zhengshoudong.github.io//2016/07/29/关于iOS多线程的部分理解/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://zhengshoudong.github.io//2016/07/29/关于iOS多线程的部分理解/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=ZHENGSHOUDONG&title=关于iOS多线程的部分理解&summary=null&pics=https://zhengshoudong.github.io/img/favicon.png&url=https://zhengshoudong.github.io/2016/07/29/关于iOS多线程的部分理解/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="关于iOS开发的多线程的理解"><a href="#关于iOS开发的多线程的理解" class="headerlink" title="关于iOS开发的多线程的理解"></a>关于iOS开发的多线程的理解</h2><p>1.iOS中有4套多线程的方案,分别是</p>
<ul>
<li>Pthreads</li>
<li>NSThread</li>
<li>GCD</li>
<li>NSOperation &amp; NSOperationQueue<br>本文会讲一些”线程同步、 延时执行、 单例模式”</li>
</ul>
<h3 id="Pthreads"><a href="#Pthreads" class="headerlink" title="Pthreads"></a>Pthreads</h3><p>这个多线程方案全称为:POSIX threads,Pthreads是它的简称,是线程的POSIX标准.该标准定义了创建和操纵线程的一整套API. 在类操作系统(Unix,Linux,Mas OS等等)中,都可以使用Pthreads作为操作系统的线程.</p>
<p>这是在多平台上通用的API,所以移植性很强,当然在iOS中也是可以用的.这是基于C的框架.使用起来涉及底层较多.感受一下:<br><a id="more"></a></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">第一步:</div><div class="line"> <span class="meta">#import<span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line">然后创建线程，并执行任务</div><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    pthread_t thread;</div><div class="line">    <span class="comment">//创建一个线程并自动执行</span></div><div class="line">    pthread_create(&amp;thread, <span class="literal">NULL</span>, start, <span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> *start(<span class="keyword">void</span> *data) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>打印输出:<br>2016-07-28 23:57:21.689 testThread[10616:2644653] <nsthread: 0x7fbb48d33690="">{number = 2, name = (null)}</nsthread:></p>
<p>这是C语言函数,需要手动处理线程的各个状态,说白了就是手动管理生命周期,比如上面这段代码虽然创建了一个线程,但并没有销毁线程.</p>
<h3 id="NSThread"><a href="#NSThread" class="headerlink" title="NSThread"></a>NSThread</h3><p>NSThread是经过Apple公司封装后的,并且是完全面向对象的.所以可以直接操作线程对象,非常直观和方便.但是它的生命周期还是需要手动管理的,所以这套方案未来的开发之路没有要求的情况下也是偶尔用用的,有更好用的为什么不用呢.下面说说更好的框架. 这个方案常用的一个类方法就是<code>[NSThread currentThread]</code>,它可以获取当前线程类,你就可以知道当前线程的各种信息,很方便,比较多的用于调试.下面看看它的一些用法:</p>
<ul>
<li>先创建线程类，再启动</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建</span></div><div class="line">  NSThread *thread = [[NSThread alloc] <span class="string">initWithTarget:</span>self <span class="string">selector:</span><span class="meta">@selector</span>(<span class="string">run:</span>) <span class="string">object:</span>nil];</div><div class="line">  <span class="comment">// 启动</span></div><div class="line">  [thread start];</div></pre></td></tr></table></figure>
<ul>
<li><p>创建并自动启动</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[NSThread <span class="string">detachNewThreadSelector:</span><span class="meta">@selector</span>(<span class="string">run:</span>) <span class="string">toTarget:</span>self <span class="string">withObject:</span>nil];</div></pre></td></tr></table></figure>
</li>
<li><p>使用 NSObject 的方法创建并自动启动</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self <span class="string">performSelectorInBackground:</span><span class="meta">@selector</span>(<span class="string">run:</span>) <span class="string">withObject:</span>nil];</div></pre></td></tr></table></figure>
<ul>
<li>其它的方法</li>
</ul>
<p>除了创建启动外，NSThread 还以很多方法,以下为常用方法.(列举并不全面),更多方法就是查看文档或者去.h文件去看</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//取消线程</span></div><div class="line">- (<span class="keyword">void</span>)cancel;</div><div class="line"></div><div class="line"><span class="comment">//启动线程</span></div><div class="line">- (<span class="keyword">void</span>)start;</div><div class="line"></div><div class="line"><span class="comment">//判断某个线程的状态的属性</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">getter</span>=isExecuting) <span class="built_in">BOOL</span> executing;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">getter</span>=isFinished) <span class="built_in">BOOL</span> finished;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">getter</span>=isCancelled) <span class="built_in">BOOL</span> cancelled;</div><div class="line"></div><div class="line"><span class="comment">//设置和获取线程名字</span></div><div class="line">-(<span class="keyword">void</span>)setName:(<span class="built_in">NSString</span> *)n;</div><div class="line">-(<span class="built_in">NSString</span> *)name;</div><div class="line"></div><div class="line"><span class="comment">//获取当前线程信息</span></div><div class="line">+ (<span class="built_in">NSThread</span> *)currentThread;</div><div class="line"></div><div class="line"><span class="comment">//获取主线程信息</span></div><div class="line">+ (<span class="built_in">NSThread</span> *)mainThread;</div><div class="line"></div><div class="line"><span class="comment">//使当前线程暂停一段时间，或者暂停到某个时刻</span></div><div class="line">+ (<span class="keyword">void</span>)sleepForTimeInterval:(<span class="built_in">NSTimeInterval</span>)time;</div><div class="line">+ (<span class="keyword">void</span>)sleepUntilDate:(<span class="built_in">NSDate</span> *)date;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h3><p><code>Grand Central Dispatch</code>是苹果为多核心的并行运算提出的解决方案,所以或自动合理的利用更多的CPU内核(比如双核,四核),最重要是它会自动管理线程的生命周期(创建线程,调度任务,销毁线程),完全不需要我们管理,我们只需要告诉干什么就行.同时它使用的也是<code>C语言</code>,不过由于使用了Block(swift里叫做闭包),所以让使用起来更加的方便灵活.所以GCD这套方案是最常用的.原因就是好用啊,(好好学这个,实用!当然其它的也是要了解明白,多明白些没有坏处滴)</p>
<h3 id="任务和队列"><a href="#任务和队列" class="headerlink" title="任务和队列"></a>任务和队列</h3><p>在<code>GCD</code>中，加入了两个非常重要的概念：<code>任务</code>和 <code>队列</code></p>
<ul>
<li>任务:就是操作,你想干什么,说白了就是你要在这里面执行什么操作的代码,在GCD中就是个Block,所以添加任务十分的方便,任务分为两种执行方式:<code>同步执行</code>和<code>异步执行</code>,他们之间的区别是!!!<code>会不会阻塞当前线程，直到 Block 中的任务执行完毕！</code>.</li>
</ul>
<h5 id="同步执行-sync-会阻塞当前线程并等待-Block-中的任务执行完毕，然后当前线程才会继续往下运行"><a href="#同步执行-sync-会阻塞当前线程并等待-Block-中的任务执行完毕，然后当前线程才会继续往下运行" class="headerlink" title="同步执行(sync):会阻塞当前线程并等待 Block 中的任务执行完毕，然后当前线程才会继续往下运行."></a>同步执行(sync):会阻塞当前线程并等待 Block 中的任务执行完毕，然后当前线程才会继续往下运行.</h5><h5 id="异步执行-async-当前线程会直接往下执行，它不会阻塞当前线程"><a href="#异步执行-async-当前线程会直接往下执行，它不会阻塞当前线程" class="headerlink" title="异步执行(async):当前线程会直接往下执行，它不会阻塞当前线程."></a>异步执行(async):当前线程会直接往下执行，它不会阻塞当前线程.</h5><ul>
<li>队列:用于存放任务.一共有两种队列,<code>串行队列</code>和<code>并行队列</code></li>
</ul>
<p><code>串行队列</code>放到串行队列的任务，GCD 会 FIFO（先进先出） 地取出来一个，执行一个，然后取下一个，这样一个一个的执行.</p>
<p><code>并行队列</code>放到并行队列的任务，GCD 也会 FIFO的取出来，但不同的是，它取出来一个就会放到别的线程，然后再取出来一个又放到另一个的线程。这样由于取的动作很快，忽略不计，看起来，所有的任务都是一起执行的。不过需要注意，GCD 会根据系统资源控制并行的数量，所以如果任务很多，它并不会让所有任务同时执行.</p>
<p>####### 同步执行(串行队列):当前线程，一个一个执行</p>
<p>####### 异步执行(串行队列):当前线程，一个一个执行</p>
<p>####### 异步执行(串行队列):其他线程，一个一个执行</p>
<p>####### 异步执行(并行队列):开很多线程，一起执行</p>
<h3 id="创建队列"><a href="#创建队列" class="headerlink" title="创建队列"></a>创建队列</h3><ul>
<li>主队列:这是一个特殊的<code>串行队列</code> 什么是主队列? 主队列用于刷新 UI，任何需要刷新 UI 的工作都要在主队列执行，所以一般耗时的任务都要放到别的线程执行。</li>
</ul>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//主队列代码</span></div><div class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = ispatch_get_main_queue();</div></pre></td></tr></table></figure>
<ul>
<li><p>自己创建的队列:自己可以创建<code>串行队列</code>,也可以创建<code>并行队列</code>.看下面的代码,它有两个参数,第一个上面已经说了,第二个才是最重要的!<br>第二个参数用来表示创建的队列是串行的还是并行的,传入 <code>DISPATCH_QUEUE_SERIAL</code>或<code>NULL</code>表示创建串行队列。传入 <code>DISPATCH_QUEUE_CONCURRENT</code>表示创建并行队列</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//串行队列</span></div><div class="line"> <span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_queue_create(<span class="string">"tk.bourne.testQueue"</span>, <span class="literal">NULL</span>);</div><div class="line"> <span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_queue_create(<span class="string">"tk.bourne.testQueue"</span>, DISPATCH_QUEUE_SERIAL);</div><div class="line"> <span class="comment">//并行队列</span></div><div class="line"> <span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_queue_create(<span class="string">"tk.bourne.testQueue"</span>, DISPATCH_QUEUE_CONCURRENT);</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>全局并行队列:只要是并行任务一般都加入到这个队列。这是系统提供的一个并发队列</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dispatch_queue_t </span>queue = <span class="keyword">dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, </span><span class="number">0</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="创建任务"><a href="#创建任务" class="headerlink" title="创建任务"></a>创建任务</h3><ul>
<li>同步任务:会阻塞当前线程 (SYNC)</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_sync</span>(&lt;<span class="meta">#queue#&gt;, ^&#123;</span></div><div class="line">     <span class="comment">//code here</span></div><div class="line">     <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line"> &#125;);</div></pre></td></tr></table></figure>
<ul>
<li>异步任务:不会阻塞当前线程 (ASYNC)</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_async</span>(&lt;<span class="meta">#queue#&gt;, ^&#123;</span></div><div class="line">      <span class="comment">//code here</span></div><div class="line">      <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
<p>  代码实例</p>
<h6 id="代码一"><a href="#代码一" class="headerlink" title="代码一"></a>代码一</h6><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSLog(<span class="string">"之前 - %@"</span>, NSThread.currentThread())</div><div class="line">dispatch_sync(<span class="name">dispatch_get_main_queue</span>(), &#123; () -&gt; Void in </div><div class="line">        NSLog(<span class="string">"sync - %@"</span>, NSThread.currentThread())</div><div class="line">&#125;)</div><div class="line">NSLog(<span class="string">"之后 - %@"</span>, NSThread.currentThread())</div></pre></td></tr></table></figure>
<h6 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h6><p>只会打印第一句：之前 - <nsthread: 0x7fb3a9e16470="">{number = 1, name = main} ，然后主线程就卡死了，你可以在界面上放一个按钮，你就会发现点不了了。</nsthread:></p>
<h6 id="为什么"><a href="#为什么" class="headerlink" title="为什么?"></a>为什么?</h6><p>同步任务会阻塞当前线程，然后把 Block 中的任务放到指定的队列中执行，只有等到 Block 中的任务完成后才会让当前线程继续往下运行。<br>打印完第一句后<code>dispatch_sync</code>立即阻塞当前的主线程，然后把 Block 中的任务放到<code>main_queue</code>中，可是<code>main_queue</code>中的任务会被取出来放到主线程中执行，但主线程这个时候已经被阻塞了，所以 Block 中的任务就不能完成，它不完成,<code>dispatch_sync</code>就会一直阻塞主线程，这就是死锁现象。导致主线程一直卡死。</p>
<h6 id="代码二"><a href="#代码二" class="headerlink" title="代码二"></a>代码二</h6><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">let queue = dispatch_queue_create(<span class="string">"myQueue"</span>, DISPATCH_QUEUE_SERIAL)</div><div class="line">   NSLog(<span class="string">"之前 - %@"</span>, NSThread.currentThread())</div><div class="line">    dispatch_async(<span class="name">queue</span>, &#123; () -&gt; Void in</div><div class="line">        NSLog(<span class="string">"sync之前 - %@"</span>, NSThread.currentThread())</div><div class="line">        dispatch_sync(<span class="name">queue</span>, &#123; () -&gt; Void in</div><div class="line">             NSLog(<span class="string">"sync - %@"</span>, NSThread.currentThread())</div><div class="line">        &#125;)</div><div class="line">        NSLog(<span class="string">"sync之后 - %@"</span>, NSThread.currentThread())</div><div class="line">   &#125;)</div><div class="line">  NSLog(<span class="string">"之后 - %@"</span>, NSThread.currentThread())</div></pre></td></tr></table></figure>
<p>待更新…</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    







                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/07/30/ZHosts更新!新添加还原功能V2.2/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            上一篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/07/28/新版本ZHosts发布/" id="post_nav-older" class="next-content">
            下一篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="ZHENGSHOUDONG's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        admin@zhengshoudong.cn
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:admin@zhengshoudong.cn" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">4</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->
<!-- 
    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>
 -->

<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/u/1715271262" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.svg);">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/ZhengShouDong" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.svg);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://zhihu.com/people/zhengshoudong" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-zhihu.svg);">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;ZHENGSHOUDONG
        </div>

        <!-- Paradox Footer Right Section -->
        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>
















<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
